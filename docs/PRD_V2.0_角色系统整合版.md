# "动画宅的自我修养" V2.0 - 角色系统整合版 PRD

## 版本信息
- **版本**: V2.0 (角色系统整合版)
- **日期**: 2025年7月31日
- **基于**: V4.0战斗系统 + 动态分池抽卡机制

---

## 1. 项目概述

### 1.1 产品定位
基于Bangumi数据的网页挂机卡牌游戏，融合**动漫作品收集**和**角色养成**两大核心玩法。玩家作为动漫爱好者，通过抽卡获得动漫作品和角色，在"宅理论战"中与其他玩家进行策略对抗。

### 1.2 核心创新点
1. **数据驱动稀有度**：基于Bangumi真实评分和人气数据动态生成卡片稀有度
2. **角色灵感搭档系统**：2600+真实动漫角色为作品卡片提供战斗加成
3. **深度策略战斗**：TP资源管理 + 声望对抗 + 连击机制
4. **情感化收集体验**：角色互动、好感度、专属台词等沉浸式要素

### 1.3 目标用户
- **核心用户**：Bangumi深度用户，动漫数据达人
- **主要用户**：二次元爱好者，喜欢角色收集和卡牌策略
- **潜在用户**：轻度挂机游戏玩家，角色厨

---

## 2. 双卡系统设计

### 2.1 动漫作品卡片系统（保持原有设计）
```javascript
// 作品卡片属性
AnimeCard = {
    id: 316247,
    name: "Re：从零开始的异世界生活 第二季 后半部分",
    points: 7.6,           // Bangumi评分，战斗基础点数
    cost: 1,               // TP消耗成本
    rarity: "热门级",       // 基于动态分池的稀有度
    synergy_tags: ["TV", "日本", "奇幻", "穿越", "小说改"],
    main_character_ids: [35607, 35608]  // 关联的主要角色ID
}
```

### 2.2 角色卡片系统（全新设计）
```javascript
// 角色卡片属性
CharacterCard = {
    id: 35607,
    name: "ナツキ・スバル",
    rarity: "热门级",       // 基于角色人气和重要性的稀有度
    anime_ids: [793, 8],    // 出演作品ID列表
    level: 1,               // 角色等级（通过重复获得提升）
    affection: 0,           // 好感度（0-100）
    skills: [               // 角色技能列表
        {
            id: "protagonist_boost",
            name: "主角光环",  
            description: "与本角色相关的动漫卡片获得+0.2点数加成",
            unlocked: true
        }
    ],
    voice_lines: [...],     // 角色台词库
    interaction_data: {...} // 互动相关数据
}
```

---

## 3. 角色获取机制设计

### 3.1 动态分池角色分级
基于角色的**人气数据**（收藏数+评论数）和**作品重要性**进行自动分级：

```javascript
// 角色分级算法
角色稀有度 = f(
    角色收藏数权重 * 0.4 +
    角色评论数权重 * 0.3 +
    所属作品评分权重 * 0.2 +
    角色类型权重 * 0.1    // 主角>配角>路人
)

分级标准：
- 传说级: 极高人气 + 神作主角 (如: 鲁路修、利威尔)
- 杰作级: 高人气 + 名作主角 (如: 昴、炮姐)  
- 热门级: 中等人气 + 热门作品 (大部分主角)
- 佳作级: 低人气但有特色 (冷门作品主角)
- 趣味级: 路人角色、梗角色
```

### 3.2 角色获取途径

**途径1: 作品关联获取**
```javascript
// 当抽到动漫作品时，触发角色获取判定
获得动漫卡片时：
- 100%获得该作品的1个随机角色
- 20%概率获得该作品的主角色
- 5%概率获得该作品的传说级角色（如果有）
```

**途径2: 独立角色卡池**
```javascript
// 专门的角色抽卡池
角色池抽卡概率：
- 60% 佳作级角色
- 25% 热门级角色  
- 12% 杰作级角色
- 3% 传说级角色

每日免费角色抽卡券：1张
购买价格：150知识点/张
```

**途径3: 特殊获取方式**
- **羁绊解锁**：收集同作品3个角色后，解锁该作品隐藏角色
- **成就奖励**：完成特定成就获得纪念角色
- **活动限定**：节日或纪念活动的限定角色

---

## 4. 角色战斗系统整合

### 4.1 灵感搭档机制
```javascript
// 灵感搭档系统核心逻辑
角色战斗加成计算：
1. 直接关联加成：
   - 角色与其出演作品的卡片 → +0.3点数加成
   - 同作品多角色在场 → 每额外1个角色+0.1点数

2. 间接关联加成：
   - 相同TAG的作品 → +0.1点数加成  
   - 相同制作公司 → +0.05点数加成

3. 角色技能触发：
   - 特定条件下触发角色专属技能
   - 技能可影响TP获取、声望变化、抽卡奖励等
```

### 4.2 角色技能系统
```javascript
// 角色技能分类与示例
技能类型：
1. 被动加成类：
   - "主角光环": 相关作品+0.2点数
   - "人气王": 每回合额外+0.5TP
   - "治愈系": 防守成功时额外+1声望

2. 主动技能类：
   - "王者威严": 消耗2TP，下次攻击必定获得最高收益
   - "卖萌攻势": 对方必须选择"赞同"，无法"反驳"
   - "黑化爆发": 声望低于15时，所有攻击伤害翻倍

3. 触发条件类：
   - "复仇": 声望被降低时，下次反击+2声望
   - "连击大师": 3连击成功时，立即获得一次额外攻击
   - "逆转": 声望落后时，防守成功率+50%
```

### 4.3 角色在V4.0战斗中的具体作用

**战斗前准备阶段**：
- 选择最多3个角色作为"灵感搭档"
- 每个角色占用1个"灵感槽"，高等级玩家可解锁更多槽位
- 角色技能在战斗开始前预设

**战斗中实时影响**：
```javascript
// 攻击阶段角色影响
攻击计算修正：
1. 检查打出的动漫卡片是否有关联角色在场
2. 计算角色加成：基础点数 + 角色加成
3. 检查角色技能触发条件
4. 应用技能效果（TP加成、强制效果等）

// 防守阶段角色影响  
防守计算修正：
1. 角色可提供额外的防守选项
2. 某些角色技能可以降低防守成本
3. 角色好感度影响防守成功率
```

---

## 5. 角色成长与互动系统

### 5.1 角色升级系统
```javascript
// 角色升级数据结构
CharacterLevel = {
    level: 1-50,           // 最高50级
    exp: 0,                // 当前经验值
    exp_to_next: 100,      // 升级所需经验
    stat_bonus: {          // 等级加成
        point_bonus: 0.05 * level,    // 每级+0.05点数加成
        tp_efficiency: 0.02 * level,  // 每级降低2%TP消耗
        skill_power: 0.1 * level      // 技能效果增强
    }
}

// 经验值获取方式
角色经验获得：
- 使用角色参与战斗胜利：+50 EXP
- 使用角色参与战斗失败：+20 EXP  
- 角色相关作品被使用：+10 EXP
- 每日互动：+30 EXP
- 重复抽到该角色：+200 EXP
```

### 5.2 好感度系统
```javascript
// 好感度机制
Affection = {
    level: 0-100,          // 好感度等级
    daily_interaction: 3,  // 每日可互动次数
    interaction_types: [
        "对话", "赠送礼物", "一起看番", "战斗配对"
    ],
    affection_rewards: {
        20: "解锁角色语音",
        40: "解锁专属技能", 
        60: "解锁角色故事",
        80: "解锁特殊皮肤",
        100: "解锁誓约形态"  // 最高形态，提供最强加成
    }
}
```

### 5.3 角色互动内容
```javascript
// 丰富的互动内容设计
InteractionContent = {
    voice_lines: {
        greeting: ["早上好，今天也要努力呢！"],
        battle_start: ["让我来帮你吧！"],
        battle_victory: ["我们赢了！太棒了！"],
        battle_defeat: ["没关系，下次会更好的！"],
        affection_up: ["谢谢你这么关心我..."],
        seasonal: ["春天到了，想和你一起赏樱呢~"]
    },
    
    character_stories: [
        // 基于好感度解锁的角色个人故事
        {
            id: 1,
            title: "初次相遇",
            content: "...",
            unlock_condition: "affection >= 20"
        }
    ],
    
    special_events: [
        // 基于日期的特殊事件
        {
            date: "12-25",
            event: "圣诞节特别对话",
            content: "..."
        }
    ]
}
```

---

## 6. 商业化模式设计

### 6.1 核心付费点
```javascript
// 精准的付费设计
付费内容设计：
1. 角色相关：
   - 角色抽卡券包 (¥6-30)
   - 角色经验加速药水 (¥3-12)  
   - 好感度礼物包 (¥5-25)
   - 限定角色皮肤 (¥15-50)

2. 战斗相关：
   - 灵感槽位扩展 (¥20-80)
   - 技能重置券 (¥5-15)
   - 战斗加成道具 (¥3-10)

3. 收集相关：
   - 月卡 (¥30/月): 每日额外资源
   - 大R包 (¥98-648): 大量抽卡券+限定角色
   - 收藏册扩展 (¥10-50)
```

### 6.2 用户价值与付费转化
```javascript
// 付费心理分析
用户付费动机：
1. 收集动机 (40%): 想要获得特定角色
2. 竞技动机 (25%): 希望在PVP中获得优势  
3. 社交动机 (20%): 炫耀稀有角色、皮肤
4. 情感动机 (15%): 对特定角色的喜爱

预期转化率：
- 免费用户: 75-80%
- 小额付费: 15-20% (月消费¥10-50)
- 中额付费: 3-5% (月消费¥50-200)  
- 大额付费: 1-2% (月消费¥200+)
```

---

## 7. 技术实现要点

### 7.1 数据库设计
```sql
-- 核心表结构
-- 角色表
CREATE TABLE characters (
    id INT PRIMARY KEY,
    name VARCHAR(255),
    rarity ENUM('传说级','杰作级','热门级','佳作级','趣味级'),
    anime_ids JSON,  -- 关联作品列表
    base_stats JSON, -- 基础属性
    skills JSON,     -- 技能列表
    voice_lines JSON -- 语音台词
);

-- 用户角色表
CREATE TABLE user_characters (
    user_id INT,
    character_id INT,
    level INT DEFAULT 1,
    exp INT DEFAULT 0,
    affection INT DEFAULT 0,
    unlock_date TIMESTAMP,
    is_favorite BOOLEAN DEFAULT FALSE,
    INDEX(user_id, character_id)
);

-- 战斗记录表
CREATE TABLE battle_logs (
    battle_id VARCHAR(36) PRIMARY KEY,
    player1_id INT,
    player2_id INT,
    player1_characters JSON, -- 使用的角色
    player2_characters JSON,
    battle_result JSON,      -- 详细战斗结果
    created_at TIMESTAMP
);
```

### 7.2 核心算法实现
```javascript
// 角色战斗加成计算算法
function calculateCharacterBonus(animeCard, activeCharacters) {
    let totalBonus = 0;
    
    for (let character of activeCharacters) {
        // 直接关联检查
        if (character.anime_ids.includes(animeCard.id)) {
            totalBonus += 0.3 + (character.level * 0.01);
        }
        
        // TAG关联检查
        if (hasCommonTags(animeCard, character.related_tags)) {
            totalBonus += 0.1 + (character.affection / 1000);
        }
        
        // 技能效果计算
        for (let skill of character.active_skills) {
            totalBonus += calculateSkillBonus(skill, animeCard, gameState);
        }
    }
    
    return Math.min(totalBonus, 1.0); // 最大1.0加成限制
}

// 角色技能触发判定
function checkSkillTrigger(skill, gameContext) {
    switch(skill.trigger_type) {
        case 'battle_start':
            return gameContext.turn === 1;
        case 'hp_low':
            return gameContext.player.prestige <= 10;
        case 'combo_success':
            return gameContext.consecutive_attacks >= 2;
        default:
            return evaluateCustomCondition(skill.condition, gameContext);
    }
}
```

---

## 8. 运营策略规划

### 8.1 内容运营
```javascript
// 持续内容更新计划
运营活动设计：
1. 每月主题活动：
   - "京都动画月": 京都动画作品和角色UP
   - "机甲大战": 机甲类作品专题活动
   - "声优祭": 同声优角色联动活动

2. 季节性活动：
   - 春季: 新番联动，推出最新角色
   - 夏季: 海滩主题皮肤，夏日限定角色
   - 秋季: 万圣节恐怖番联动
   - 冬季: 圣诞&新年限定内容

3. 社区活动：
   - 角色人气投票
   - 用户创作征集（角色同人、攻略）
   - 高端玩家对战赛事
```

### 8.2 用户留存策略
```javascript
// 多层次留存机制
留存策略：
1. 新手期 (1-7天):
   - 保证获得1个传说级角色
   - 专属新手任务，快速体验核心玩法
   - 新手专属客服，及时解答问题

2. 成长期 (8-30天):
   - 每周特殊签到，获得稀有角色
   - 解锁更多游戏功能和玩法
   - 加入公会系统，增强社交粘性

3. 稳定期 (30天+):
   - 深度收集目标，完美主义驱动
   - 竞技排名系统，提供长期目标
   - 定期新内容，保持新鲜感
```

---

## 9. 风险评估与应对

### 9.1 技术风险
- **风险**: 角色数据量庞大，可能影响性能
- **应对**: 采用分页加载、缓存机制、CDN加速

### 9.2 内容风险  
- **风险**: 角色形象版权问题
- **应对**: 确保使用官方授权素材，建立版权管理流程

### 9.3 商业风险
- **风险**: 用户付费意愿不足
- **应对**: 提供充足免费内容，建立多元化收入模式

---

## 10. 项目里程碑

### Phase 1: 角色系统基础 (1-2个月)
- [ ] 角色数据整合与分级
- [ ] 基础角色展示界面
- [ ] 角色获取机制实现
- [ ] 简单的灵感搭档系统

### Phase 2: 战斗整合与互动 (2-3个月)
- [ ] 角色技能系统完整实现
- [ ] 角色战斗加成计算
- [ ] 基础互动功能（对话、好感度）
- [ ] 角色升级系统

### Phase 3: 深度功能与商业化 (3-4个月)
- [ ] 完整的角色故事内容
- [ ] 皮肤系统与付费点
- [ ] 社交功能（分享、排行）
- [ ] 运营活动系统

### Phase 4: 优化与扩展 (持续)
- [ ] 用户反馈收集与优化
- [ ] 新角色内容持续更新
- [ ] 高级功能扩展
- [ ] 跨平台扩展准备

---

**总结**: 这个V2.0版本将原有的动漫作品卡牌游戏升级为"作品+角色"双卡系统，通过2600+真实角色数据提供深度的情感连接和策略深度。角色系统不仅增强了游戏的收集价值，更通过灵感搭档机制深度融入了战斗系统，为玩家提供更丰富、更有层次的游戏体验。

同时，基于角色的商业化模式将为项目提供稳定的收入来源，预计可在6-12个月内实现盈利。