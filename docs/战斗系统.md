# 宅理论战 - 战斗系统详解

> 基于实际代码实现的完整战斗机制说明

## 🎯 游戏目标

**获胜条件（任一达成即可获胜）：**
1. **声望击败**：将对方声望降至 0 或以下
2. **议题控制**：让议题偏向度达到 ±10
   - 玩家获胜：议题偏向度达到 +10
   - AI获胜：议题偏向度达到 -10
3. **时间判定**：12回合后按剩余声望判定胜负

## ⚖️ 初始状态

- **声望值**：双方各 30 点
- **TP值**：双方各 2 点
- **手牌数量**：各 5 张
- **卡组构成**：30张动画卡牌 + 4张角色卡牌
- **议题偏向度**：0（中性）

## 🔄 回合机制

### 回合开始阶段
1. **TP恢复**：双方TP恢复到上限
   - TP上限公式：`2 + (当前回合数 - 1)`
   - 最高TP上限：10
2. **抽牌补充**：主动玩家抽取1张卡牌
3. **角色轮换重置**：重置角色轮换次数限制
4. **技能冷却**：减少角色技能冷却时间
5. **持续效果处理**：处理回合开始时的持续效果

### 行动阶段
玩家可以进行以下行动：
- **出牌攻击**：选择动画卡牌和攻击方式
- **角色轮换**：每回合最多1次，切换主辩手
- **跳过回合**：直接结束当前回合

### 回合结束阶段
1. **持续效果处理**：处理回合结束时的持续效果
2. **胜利条件检查**：检查是否有玩家达成获胜条件
3. **回合数检查**：如果达到12回合，进行最终判定

## ⚔️ 战斗机制

### 行动类型及TP消耗
| 行动类型 | TP消耗 | 说明 |
|---------|--------|------|
| 友好安利 | 0 | 温和推荐，基础攻击方式 |
| 辛辣点评 | 1 | 犀利评价，增强攻击效果 |
| 赞同 | 0 | 温和防御，风险较低 |
| 反驳 | 1 | 激进防御，高风险高回报 |

### 强度计算
- **基础强度**：卡牌点数值
- **角色加成**：主辩手角色技能提供的强度加成
- **最终强度**：基础强度 + 角色加成

### 强度差异判定
根据 `攻击强度 - 防御强度` 的差值进行分类：
- **≥ 5**：压倒性优势
- **1-4**：轻微优势  
- **0**：平局
- **-1 到 -4**：轻微劣势
- **≤ -5**：压倒性劣势

## 📊 战斗结果表

### 友好安利 + 赞同
| 强度差异 | 攻击方声望 | 防御方声望 | 议题偏向 |
|---------|-----------|-----------|---------|
| 压倒性优势(≥5) | +1 | -4 | +2 |
| 轻微优势(1-4) | +0 | -3 | +1 |
| 平局(0) | +0 | +0 | +0 |
| 轻微劣势(-1~-4) | -3 | +0 | +0 |
| 压倒性劣势(≤-5) | -4 | +0 | +0 |

### 友好安利 + 反驳
| 强度差异 | 攻击方声望 | 防御方声望 | 议题偏向 |
|---------|-----------|-----------|---------|
| 压倒性优势(≥5) | +1 | -5 | +2 |
| 轻微优势(1-4) | +0 | -4 | +1 |
| 平局(0) | -1 | +1 | +0 |
| 轻微劣势(-1~-4) | -2 | +0 | +0 |
| 压倒性劣势(≤-5) | -3 | +0 | +0 |

### 辛辣点评 + 赞同
| 强度差异 | 攻击方声望 | 防御方声望 | 议题偏向 |
|---------|-----------|-----------|---------|
| 压倒性优势(≥5) | +0 | -6 | +3 |
| 轻微优势(1-4) | +0 | -5 | +2 |
| 平局(0) | +0 | +0 | +1 |
| 轻微劣势(-1~-4) | -5 | +0 | +0 |
| 压倒性劣势(≤-5) | -6 | +0 | +1 |

### 辛辣点评 + 反驳
| 强度差异 | 攻击方声望 | 防御方声望 | 议题偏向 |
|---------|-----------|-----------|---------|
| 压倒性优势(≥5) | +0 | -7 | +3 |
| 轻微优势(1-4) | +0 | -6 | +2 |
| 平局(0) | +0 | +0 | +0 |
| 轻微劣势(-1~-4) | -4 | +0 | +0 |
| 压倒性劣势(≤-5) | -5 | +0 | +0 |

## 🎯 战术要点

### TP管理策略
- **保守策略**：多使用友好安利和赞同，稳定积累优势
- **激进策略**：使用辛辣点评和反驳，追求快速击败
- **混合策略**：根据场面情况灵活选择

### 议题偏向度控制
- 玩家优势时议题偏向正数方向发展
- AI优势时议题偏向负数方向发展
- 议题偏向度是重要的获胜路径，注意控制

### 角色系统
- **主辩手**：当前发言的角色，影响卡牌强度
- **角色轮换**：每回合可轮换1次主辩手
- **角色技能**：提供强度加成或特殊效果

### 卡牌选择
- 高点数卡牌在关键时刻使用
- 考虑角色技能与卡牌的协同效应
- 保持手牌多样性以应对不同情况

## 🔧 技术实现要点

### 关键文件
- `/src/core/battle/TurnManager.ts` - 回合流程控制
- `/src/core/calculation/BattleEngine.ts` - 战斗计算引擎
- `/src/core/calculation/RewardCalculator.ts` - 奖励计算
- `/src/stores/battle/` - 战斗状态管理

### 状态管理
- `gameStore` - 游戏全局状态（回合、阶段、议题偏向等）
- `playerStore` - 玩家状态（声望、TP、手牌、角色等）
- `historyStore` - 战斗历史记录

### 胜利条件检查
在每次战斗结果应用后自动检查：
1. 声望值 ≤ 0
2. 议题偏向度 ≥ ±10
3. 回合数达到上限

---

*最后更新：2025-09-04*
*基于实际代码实现编写*